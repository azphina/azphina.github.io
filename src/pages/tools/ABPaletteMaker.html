<!DOCTYPE html>
<title>ANTONBLAST Palette Maker</title>
<meta content="ANTONBLAST Palette Maker" property="og:title" />
<meta content="I love the Canvas API!" property="og:description" />
<meta content="#FF0000" data-react-helmet="true" name="theme-color" />

<style>
    @font-face {
        font-family: 'Kaiju';
        src: url('/fonts/gomarice_kaiju_monster.ttf');
    }

    @font-face {
        font-family: 'Bitty';
        src: url('/fonts/Bitty.ttf');
    }

    body {
        background: #0c0230;
        background-image: linear-gradient(rgb(59, 0, 0) .1em, transparent .1em), linear-gradient(90deg, rgb(59, 0, 0) .1em, transparent .1em);
        background-size: 1em 1em;
    }

    h1 {
        display: flex;
        justify-content: center;
        color: white;
        font-family: 'Kaiju';
        font-size: 3vw;
        margin-right: 50%;
    }

    p {
        display: flex;
        justify-content: center;
        color: white;
        text-align: center;
        font-family: 'Bitty';
        font-size: 40px;
    }

    label {
        color: white;
        font-family: 'Bitty';
        font-size: 2vw;
        margin-left: 1vw;
    }

    canvas {
        max-height: 100%;
        image-rendering: pixelated;
        font-smooth: never;
        -webkit-font-smoothing : none;
        padding: 0;
        margin: auto;
        display: block;
        width: 600px;
        height: 500px;
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
    }

    .editor {
        position: absolute;
        top: 0;
        bottom: 0;
        right: 0;
        left: 50%;
        height: 100vh;
        background-color: rgba(0, 0, 0, 0.5);
    }

    .preview {
        position: absolute;
        top: 0;
        bottom: 0;
        right: 50%;
        left: 0;
        height: 100vh;
    }

    .colors {
        display: flex;
        column-gap: 5px;
        justify-content: center;
        align-items: center;
    }

    input {
        font-family: 'Bitty';
        font-size: 1.4vw;
        text-align: right;
        float: right;
        position: relative;
        background: #000000;
        color: white;
        border: 2px solid #ffffff;
        border-radius: 5%;
    }

    select {
        font-family: 'Bitty';
        font-size: 2vw;
        text-align: left;
        width: 16vw;
        position: relative;
        color: white;
        border: 2px solid #ffffff;
        background: #000000;
        border-radius: 5%;
    }

    button {
        font-family: 'Bitty';
        font-size: 2vw;
        color: white;
        border: 2px solid #ffffff;
        background: #000000;
        border-radius: 5%;
    }

    #paul {
        position: fixed;
        bottom: 0;
        left: 0;
    }

    .editorcontent {
        position: relative;
		right: 0;
		top: 30%;
    }
</style>

<body>
    <h1>ANTONBLAST Palette Maker v2</h1>
        <div id="paul" onClick="swapMode()">
        <img
            src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAgCAYAAAD9oDOIAAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAAGYktHRAD/AP8A/6C9p5MAAAAHdElNRQfpAgEEDxZLptWtAAABW0lEQVRIx62WsXHEIBBFPzoFlOAyGEcXuoRLnF8pKsW5E5Xg0JFHZbgEAntwIMEBuwuLxjtzowOWx98vkGQgxCtwydvvwI+QN2c5vwBg0I4AfRjy57+AADAJSRcFSBRgNEkxvHNF224by5CUdoGtmJm+ECGHEhqfb/tCAKx1AR1PE5C71mGti2NBghYDokrZmjRf5SlZ4HoHrveighxc37mi/DNht62Akm3UvFm0fAINWBeafVu6QCZM21NuIQDee/aKw0715i98s5a9RgtPQXsxQfIT2D2VxjrQfqxq+KCnUXWE00UMss3/KD/fQusyVv4+t1J6W+CdS78EPLFXk2TuaI48VHJP51ZGPKYfz99N0svXU9Ge0Hj5aYC1yghlSx0E8nRUTykt8Ci9qJZ4OqKu9pKUj/7XiqSQzONAIVebq4n9XMk9KEDfAobpF6Hc2dd+Q4l5ZiRZy/gDLTyB8b5K14QAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjUtMDItMDFUMDQ6MTU6MjIrMDA6MDCvbW4UAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDI1LTAyLTAxVDA0OjE1OjIyKzAwOjAw3jDWqAAAACh0RVh0ZGF0ZTp0aW1lc3RhbXAAMjAyNS0wMi0wMVQwNDoxNToyMiswMDowMIkl93cAAAAASUVORK5CYII=">
    </div>
    <div class="editor">
        <div class="editorcontent">
        <label for="palName">Name (Anton)</label>
        <input id="palName" type="text" oninput="updateColors()" style="font-family: Kaiju;">
        <br>
        <label for="palDesc">Description (Anton)</label>
        <input id="palDesc" type="text" oninput="updateColors()">
        <br>
        <label for="palNameAnnie">Name (Annie)</label>
        <input id="palNameAnnie" type="text" oninput="updateColors()" style="font-family: Kaiju;">
        <br>
        <label for="palDescAnnie">Description (Annie)</label>
        <input id="palDescAnnie" type="text" oninput="updateColors()">
        <br>
        <br>
        <div class="colors" id="colors"></div>
        <br>
        <br>
        <div class="colors" id="buttons">
            <button type="button" onClick="download()">Download Showcase</button>
            <button type="button" onClick="downloadPart(297, 218, 2, 11, 'antonPal.png')">Download Anton's Palette
                Strip</button>
            <button type="button" onClick="downloadPart(301, 218, 2, 11, 'anniePal.png')">Download Annie's Palette
                Strip</button>
        </div>
        <p>Credits<br>azphina - Tool</p>
        <p><img src="/images/abpalette/sp_cameo_jeotslay_idle_0.gif">Mr. Kalpso - Template</p>
        </div>
    </div>
    <div class="preview">
    <canvas id="myCanvas" width="600" height="500"></canvas>
    </div>
</body>
<script>
    //https://stackoverflow.com/questions/5026961/html5-canvas-ctx-filltext-wont-do-line-breaks
    function printAtWordWrap(context, text, x, y, lineHeight, fitWidth) {
        fitWidth = fitWidth || 0;

        if (fitWidth <= 0) {
            context.fillText(text, x, y);
            return;
        }
        var words = text.split(' ');
        var currentLine = 0;
        var idx = 1;
        while (words.length > 0 && idx <= words.length) {
            var str = words.slice(0, idx).join(' ');
            var w = context.measureText(str).width;
            if (w > fitWidth) {
                if (idx == 1) {
                    idx = 2;
                }
                context.fillText(words.slice(0, idx - 1).join(' '), x, y + (lineHeight * currentLine));
                currentLine++;
                words = words.splice(idx - 1);
                idx = 1;
            }
            else { idx++; }
        }
        if (idx > 0)
            context.fillText(words.join(' '), x, y + (lineHeight * currentLine));
    }

    const rgbArrayToHex = rgb => `#${rgb.map(v => v.toString(16).padStart(2, '0')).join('')}`;
    const hexToRGBArray = (hex) => {
        const r = parseInt(hex.slice(1, 3), 16)
        const g = parseInt(hex.slice(3, 5), 16)
        const b = parseInt(hex.slice(5, 7), 16)
        return [r, g, b]
    }
    function isColor(array, position, color) {
        return array[position] === color[0] && array[position + 1] === color[1] && array[position + 2] === color[2] && array[position + 3] === color[3];
    }
    let antonList = [
        {
            color: [255, 0, 0, 255],
            name: "Anton's Skin"
        },
        {
            color: [153, 0, 0, 255],
            name: "Anton's Skin (Shade 1)"
        },
        {
            color: [102, 0, 0, 255],
            name: "Anton's Skin (Shade 2)"
        },
        {
            color: [170, 255, 0, 255],
            name: "Anton's Outfit"
        },
        {
            color: [51, 153, 0, 255],
            name: "Anton's Outfit (Shade 1)"
        },
        {
            color: [0, 102, 0, 255],
            name: "Anton's Outfit (Shade 2)"
        },
        {
            color: [255, 255, 255, 255],
            name: "Anton's Eyes & Highlights"
        },
        {
            color: [122, 143, 153, 255],
            name: "Anton's Eyes & Highlights (Shade 1)"
        },
        {
            color: [46, 46, 77, 255],
            name: "Anton's Hair"
        },
        {
            color: [30, 26, 51, 255],
            name: "Anton's Hair (Shade 1)"
        },
        {
            color: [0, 0, 0, 255],
            name: "Anton's Hair (Shade 2)"
        },
        {
            color: [255, 0, 255, 255],
            name: "Antomic Blast Flash"
        }
    ]
    let annieList = [
        {
            color: [170, 255, 0, 255],
            name: "Annie's Skin"
        },
        {
            color: [51, 153, 0, 255],
            name: "Annie's Skin (Shade 1)"
        },
        {
            color: [0, 102, 0, 255],
            name: "Annie's Skin (Shade 2)"
        },
        {
            color: [255, 0, 0, 255],
            name: "Annie's Outfit"
        },
        {
            color: [153, 0, 0, 255],
            name: "Annie's Outfit (Shade 1)"
        },
        {
            color: [102, 0, 0, 255],
            name: "Annie's Outfit (Shade 2)"
        },
        {
            color: [255, 255, 255, 255],
            name: "Annie's Eyes & Highlights"
        },
        {
            color: [122, 143, 153, 255],
            name: "Annie's Eyes & Highlights (Shade 1)"
        },
        {
            color: [46, 46, 77, 255],
            name: "Annie's Skirt"
        },
        {
            color: [30, 26, 51, 255],
            name: "Annie's Skirt (Shade 1)"
        },
        {
            color: [0, 0, 0, 255],
            name: "Annie's Skirt (Shade 2)"
        },
        {
            color: [255, 0, 255, 255],
            name: "Antomic Blast Flash (Annie)"
        }
    ]
    var antonDropDown = makeDropDown(antonList, "antonList")
    for (let c of antonList)
        createColorPicker(c)
    var annieDropDown = makeDropDown(annieList, "annieList")
    for (let c of annieList)
        createColorPicker(c)
    updateVisible()
    function createColorPicker(c) {
        var input = document.createElement("input");
        input.type = "color";
        input.id = c.name;
        input.value = rgbArrayToHex(c.color.slice(0, -1))
        document.getElementById("colors").appendChild(input);
        input.addEventListener("input", updateColors, false);
    }
    function makeDropDown(list, name) {
        var select = document.createElement("select");
        select.name = name
        select.id = name
        document.getElementById("colors").appendChild(select);
        for (let entry of list) {
            var option = document.createElement("option")
            option.value = entry.name
            option.textContent = entry.name
            select.appendChild(option)
        }
        select.addEventListener("change", updateVisible, false);
        return select;
    }
    document.getElementById("Antomic Blast Flash").value = "#ffffff";
    document.getElementById("Antomic Blast Flash (Annie)").value = "#ffffff"
    //canvas
    let canvas = document.getElementById("myCanvas");
    let context = canvas.getContext("2d", { willReadFrequently: true });
    //Image itself... :3
    let templateA = new Image;
    templateA.src = "/images/abpalette/template.png"
    //imagedata
    let imgDataL;
    let imgDataR;

    let mode = 0;

    templateA.onload = function () {
        context.drawImage(templateA, 0, 0);
        imgDataL = context.getImageData(0, 0, canvas.width / 2, canvas.height);
        imgDataR = context.getImageData(canvas.width / 2, 0, canvas.width / 2, canvas.height);
        updateColors();
    }
    function updateColors() {
        context.clearRect(0, 0, canvas.width, canvas.height);
        var locked;
        var NewL = new ImageData(new Uint8ClampedArray(imgDataL.data), imgDataL.width, imgDataL.height);
        var NewR = new ImageData(new Uint8ClampedArray(imgDataR.data), imgDataR.width, imgDataR.height);
        locked = new Array(NewL.data.length).fill(false);
        for (let c of antonList) {
            var element = document.getElementById(c.name)
            for (let i = 0; i < NewL.data.length; i += 4) {
                if (isColor(NewL.data, i, c.color) && locked[i] == false) {
                    var rgb = hexToRGBArray(element.value);
                    NewL.data[i] = rgb[0];
                    NewL.data[i + 1] = rgb[1];
                    NewL.data[i + 2] = rgb[2];
                    NewL.data[i + 3] = 255;
                    locked[i] = true;
                }
            }
        }
        context.putImageData(NewL, 0, 0);
        locked = new Array(NewR.data.length).fill(false);
        for (let c of annieList) {
            var element = document.getElementById(c.name)
            for (let i = 0; i < NewR.data.length; i += 4) {
                if (isColor(NewR.data, i, c.color) && locked[i] == false) {
                    var rgb = hexToRGBArray(element.value);
                    NewR.data[i] = rgb[0];
                    NewR.data[i + 1] = rgb[1];
                    NewR.data[i + 2] = rgb[2];
                    NewR.data[i + 3] = 255;
                    locked[i] = true;
                }
            }
        }
        context.putImageData(NewR, canvas.width / 2, 0);
        let l = canvas.width / 4
        let r = 3 * l
        if (mode)
        {
            context.clearRect(0, 0, 150, 300)
            context.clearRect(450, 0, 150, 300)
            l = 3 * (canvas.width / 8)
            r = 5 * (canvas.width / 8)
        }
        context.textRendering = 'geometricPrecision';
        context.font = "48px Kaiju";
        context.fillStyle = 'white';
        context.textAlign = 'center'
        context.textBaseline = 'top';
        context.fillText(document.getElementById("palName").value, l, 310);
        context.fillText(document.getElementById("palNameAnnie").value, r, 310);
        context.font = "30px Bitty";
        printAtWordWrap(context, document.getElementById("palDesc").value, l, 350, 15, 125);
        printAtWordWrap(context, document.getElementById("palDescAnnie").value, r, 350, 15, 125);
    }
    function updateVisible() {
        var pickers = document.getElementsByTagName("input");
        for (let element of pickers) {
            console.log(antonDropDown.value);
            if (element.id != antonDropDown.value && element.id != annieDropDown.value && element.type == "color")
                element.style.display = 'none';
            else
                element.style.display = 'inline';
        }
    }
    function download() {
        var link = document.createElement('a');
        link.download = 'MyABPalette.png';
        link.href = document.getElementById('myCanvas').toDataURL()
        link.click();
    }

    function downloadPart(x, y, w, h, name) {
        var tempCanvas = document.createElement('canvas');
        tempCanvas.width = w;
        tempCanvas.height = h;
        var tempContext = tempCanvas.getContext('2d');
        tempContext.drawImage(canvas, x, y, w, h, 0, 0, w, h);
        var link = document.createElement('a');
        link.download = name;
        link.href = tempCanvas.toDataURL()
        link.click();
        tempCanvas.remove();
    }

    function swapMode()
    {
        mode = Math.abs(1 - mode)
        updateColors()
    }
</script>

</html>